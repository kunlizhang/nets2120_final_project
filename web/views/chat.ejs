<!DOCTYPE html>
<html>
<head>
	<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js'></script>
	<script src="/socket.io/socket.io.js"></script>
    <!-- CSS only -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
	<meta name='viewport' content='width=device-width, initial-scale=1'></meta>
</head>
<style>
    html, body {
        height: 100%;
    }

    .form-signin {
        width: 100%;
        max-width: 330px;
        padding: 15px;
        margin: 0 auto;
    }

    .form-signin .form-control {
        position: relative;
        box-sizing: border-box;
        height: auto;
        padding: 10px;
        font-size: 16px;
    }

    body {
        display: -ms-flexbox;
        display: -webkit-box;
        display: flex;
        -ms-flex-align: center;
        -ms-flex-pack: center;
        -webkit-box-align: center;
        align-items: center;
        -webkit-box-pack: center;
        justify-content: center;
        padding-top: 40px;
        padding-bottom: 40px;
        background-color: #f5f5f5;
    }

    .form-signin input[type="text"] {
        margin-bottom: -1px;
        border-bottom-right-radius: 0;
        border-bottom-left-radius: 0;
    }
    
    .form-signin input[type="password"] {
        margin-bottom: 10px;
        border-top-left-radius: 0;
        border-top-right-radius: 0;
    }
</style>

<script>
	var chat_id = window.location.href.split('id=')[1];
	var socket = io();
	var time_sent = "0";
	function sendChat() {
		if ($('#input').val().trim() !== '') {
			$.post('/addMessage', {content: $('#input').val().trim(), sender: $('#username').text(),
										chat_id: chat_id, time: time_sent}, function (data) {
				if (data.success) {
					socket.emit('message sent', {
						content: $('#input').val().trim(),
						sender: $('#username').text(),
						room: chat_id,
						time: time_sent
					});
					$('#input').val('');
					$('#input').focus();
				}
			});
		}
	}
	
	$(document).ready(function () {
		socket.emit("join room", {
			room: chat_id
		});
		
		socket.on('message sent', function(msg) {
			var message_temp = document.createElement("li");
			if ($('#username').text() === msg.sender) {
				message_temp.setAttribute("class", "me");
			} else {
				message_temp.setAttribute("class", "other");
			}
			message_temp.appendChild(document.createTextNode(msg.content));
			$('#messages').append(message_temp);
			$('#messages').animate({
				scrollTop: $('#messages').get(0).scrollHeight
			}, 0);
		});
	});
</script>
<body class="text-center">
	<!-- This is a simple example template with a form that has a single input field. 
		   You'll need something similar for the login page -->
    
    <div>
    	<ul id="messages">
    	</ul>
    </div>
    <form id="message-form">
    	<div id="form-message">
    		<input class="form-control" id="input" autocomplete="off" placeholder="type a message..."
    		  onfocus="this.placeholder = ''" onblur="this.placeholder = 'type a message...'">
    		<button type="button" id="send-btn" class="btn btn-light" onclick="return sendChat();"><i
    			class="material-icons" style="font-size:26px;">send</i></button>
    	</div>
    </form>
    <div id="username">
    	<%= username %>
    </div>
    
</body>
</html>
